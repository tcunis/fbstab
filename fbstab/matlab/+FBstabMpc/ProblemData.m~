classdef ProblemData
% Structure to hold references to the problem data.
% See the class documentation or (29) in 
% https://arxiv.org/pdf/1901.04046.pdf for more details.
%%

properties (Dependent)
    N, nx, nu, nc, isvalid;
end

properties
    Q;	% N + 1 vector of nx x nx matrices
    R;  % N + 1 vector of nu x nu matrices
    S;  % N + 1 vector of nu x nx matrices
    q;  % N + 1 vector of nx x 1 vectors
    r;  % N + 1 vector of nu x 1 vectors
    A;  % N vector of nx x nx matrices
    B;  % N  vector of nx x nu matrices
    c;  % N vector of nx vectors
    E;  % N + 1 vector of nc x nx matrices
    L;  % N + 1 vector of nc x nu matrices
    d;  % N + 1 vector of nc x 1 vectors
    
    x0;	% nx x 1 vector
end

methods
    function obj=ProblemData(N,nx,nu,nc)
        % obj=ProblemData
        % obj=ProblemData(N,nx,nu,nc)
        % obj=ProblemData(s)
        if nargin==0
            % nothing to do
            return
        elseif nargin==1
            nx = N(2);
            nu = N(3);
            nc = N(4);
            N  = N(1);
        end
        
        obj.Q = zeros(N+1,nx,nx);
        obj.R = zeros(N+1,nu,nu);
        obj.S = zeros(N+1,nu,nx);
        obj.q = zeros(N+1,nx);
        obj.r = zeros(N+1,nu);
        obj.A = zeros(N,nx,nx);
        obj.B = zeros(N,nx,nu);
        obj.c = zeros(N,nx);
        obj.E = zeros(N+1,nc,nx);
        obj.L = zeros(N+1,nc,nu);
        obj.d = zeros(N+1,nc);
        
        obj.x0 = zeros(nx,1);
    end
    
    function value=get.N(obj)
        % Horizon length
        value = int32(size(obj.A,1));
    end
    
    function value=get.nx(obj)
        % Number of states
        value = int32(size(obj.A,2));
    end
    
    function value=get.nu(obj)
        % Number of inputs
        value = int32(size(obj.B,3));
    end
    
    function value=get.nc(obj)
        % Number of constraints (per timestep)
        value = int32(size(obj.E,2));
    end
    
    function value=get.isvalid(obj)
        % Check validity of problem data.
        value = all([
            assertsize(obj.Q, [N+1,nx,nx])
            assertsize(obj.R, [N+1,nu,nu])
            assertsize(obj.S, [N+1,nu,nx])
            assertsize(obj.q, [N+1,nx])
            assertsize(obj.r, [N+1,nu])
            assertsize(obj.A, = zeros(N,nx,nx);
        obj.B = zeros(N,nx,nu);
        obj.c = zeros(N,nx);
        obj.E = zeros(N+1,nc,nx);
        obj.L = zeros(N+1,nc,nu);
        obj.d = zeros(N+1,nc);
        
        obj.x0 = zeros(nx,1);

end

end

function tf = assertsize(A, sz)
% Assert that size(A) is equal to sz.
    tf = isequal(size(A), sz);
end